# 要件定義（ドラフト）

## 1. 目的
地方の郵便局で紙やホワイトボードを使って手作業で行われている休暇希望・シフト作成業務をデジタル化し、職員のシフト提出・管理を簡便にする。管理者は提出されたシフト情報を元にスプレッドシートを直接編集・管理できることを重視する。

## 2. スコープ
- React を用いた Web フロントエンド（主に PC/tablet 想定、スマホ対応は要件次第）
- 永続化先は Google スプレッドシート（提出されたデータをそのまま編集・参照できる）
- 認証・ユーザー管理（誰が提出したかを追跡）
- 管理者機能（シフト期間設定・提出状況管理・システム設定）
- シンプルで直感的な UI/UX

## 3. ステークホルダー
- エンドユーザー（郵便局の職員）: 自身の休暇希望や勤務可能日を提出する
- 管理者（シフト作成担当）: 提出を確認し、最終的なシフトを作成・編集する
- プロジェクトオーナー（あなたとご家族）: 運用・保守の意思決定

## 4. 前提・制約
- データは Google スプレッドシートを一次保存先とする
- GAS, Firebase, AWS 等のクラウドサービスは可（ただし無料枠で運用可能であること）
- ユーザーは基本的に G Suite アカウントを持たない前提（一般的なメールアドレスユーザーを想定）
- 法令・個人情報保護に配慮すること

## 5. 推奨アーキテクチャ（候補と推奨）
候補:
- A: React フロントエンド + Google Apps Script (GAS) Web API + Google Sheets
  - メリット: Google Sheets と密結合、権限管理は GAS 側で実装可能。無料で使える。
  - デメリット: 認証を Google OAuth に寄せると Google アカウントが必要になる（職員が持たない可能性）。独自認証を組む必要がある。

- B: React フロントエンド + Firebase Authentication + Firebase Functions (or client) + Google Sheets API
  - メリット: メール/パスワードや SNS サインイン等の容易な認証。無料枠で運用可能。フロントは Firebase Auth で認証し、Cloud Function 経由で Google Sheets を更新する設計にすればシート操作は安全に行える。
  - デメリット: Google Sheets へのアクセスは OAuth 設定やサービスアカウントの設定が必要。Cloud Function の無料枠を超えるとコストが発生する可能性がある。

推奨（MVP）: B のハイブリッド採用 — フロントは React、認証は Firebase Authentication（メールリンク/メール&パスワード）、サーバー側ロジックは軽量な Google Apps Script または Cloud Function を利用して Google Sheets を安全に更新する。
理由: ユーザーが Google アカウントを持たない可能性を考慮して、Firebase Auth による柔軟な認証を採用しつつ、データは要件通り Google Sheets に保存して管理者が直接編集できるようにするため。

セキュリティ上の注意点:
- Google Sheets に直接公開アクセスを与えない。認証済みのサーバー側経由（GAS/CloudFunction）で操作する。
- 管理者権限は Firebase 側で role を管理し、API に role 情報を付与して制御する。

## 6. 機能要件（高レベル）
1. 認証
   - ユーザーはメールで登録・ログインできる（メール/パスワード、またはメールリンク）
   - 管理者ユーザーの識別（role）
2. シフト提出
   - 指定期間（例: 1ヶ月単位）内の各日の勤務/休暇希望を提出できる
   - 提出は下書きと最終提出を分ける（任意）
3. シフト確認
   - 管理者は提出済みデータをカレンダー形式や表形式で閲覧できる
   - 管理者は Google スプレッドシートで提出データを参照・編集できる
4. 管理者機能
   - シフト提出期間の作成・編集
   - ユーザーの管理（管理者付与/削除）
   - システム設定（例: 勤務区分の設定）
5. ログ・監査
   - 提出日時、ユーザー ID、変更履歴を最低限記録する（スプレッドシートに記録、または別シートでログ保存）

## 7. 非機能要件
- パフォーマンス: 単一郵便局（数十名程度）の運用を想定。レスポンスは通常 3 秒以内
- 可用性: 無料枠を前提にするため厳格な SLA は不要だが、週単位の運用で目立ったダウンは避ける
- 保守性: フロントは React（Create React App / Vite）で開発し、ロジックは小さく分割
- セキュリティ: ユーザー認証必須、シートはサーバー経由で操作
- データ保持: 退職したユーザーや古いシフトは別シートにアーカイブ可能

## 8. データモデル（概略）
- Users シート
  - userId (UUID)
  - name
  - email
  - role (user|admin)
  - createdAt
- Shifts シート
  - shiftId (UUID)
  - userId
  - date (YYYY-MM-DD)
  - shiftType (work|off|half|other)
  - submittedAt
  - status (draft|submitted)
- Settings シート
  - key
  - value
- Logs シート
  - logId
  - action
  - userId
  - targetId
  - timestamp

（必要に応じてスキーマはシート設計の段階で更新）

## 9. 画面一覧（主要画面）
- ログイン画面
- ダッシュボード（提出状況の一覧）
- シフト提出画面（カレンダー／表形式で日付を編集）
- 管理者ダッシュボード（期間設定・ユーザー管理・スプレッドシート連携状況）
- スプレッドシート（管理者が直接編集する既存の Google スプレッドシート）

## 10. API / インテグレーション
- フロント → 認証: Firebase Auth SDK
- フロント → サーバー: HTTPS 経由で GAS Web App または Cloud Function を叩く（認証トークン付き）
- サーバー → Google Sheets: Sheets API または GAS の直接操作

## 11. 受け入れ基準（例）
- ユーザーはメールでアカウント作成・ログインができる
- ユーザーは指定期間内にシフト希望を提出し、提出後にデータが Google スプレッドシートに反映される
- 管理者は管理画面で期間を変更でき、提出データを一覧で確認できる
- すべての書き込みは認証済みのユーザーからのみ行える

## 12. 運用・デプロイ
- フロント: GitHub Pages / Vercel / Netlify のいずれか（無料枠）でホスティング
- サーバー: Google Apps Script（無料）または Firebase Functions（無料枠）
- 認証: Firebase Auth（無料レベルで十分）

## 13. 次のステップ
1. スプレッドシートのシート構成・サンプルデータを作成する（GAS 連携の試作）
2. 認証フローの決定（Firebase Auth の登録方法・管理者割当方法）
3. 最初の UI（ログイン & シフト提出フォーム）のモックを作る

---

このドラフトをレビューして、追加要望や優先度（MVP の定義）を教えてください。修正を反映して最終版にします。